t<html>
  <head>
    <title>Estimation frais de port</title>
    <script>
      fetch("data/tarif.json").then(j => {
        const tarifs = j.json();
        document.querySelector("form").submit=() => {
          const length = parseFloat(document.querySelector("input#length").value);
          const width = parseFloat(document.querySelector("input#width").value);
          const height = parseFloat(document.querySelector("input#height").value);
          const weight = parseFloat(document.querySelector("input#weight").value);
          const result = [];
          tarifs
            .filter(t => { return ( t.r.maxL     === null || t.r.maxL     >= length ) 
                               && ( t.r.maxW     === null || t.r.maxW     >= width  ) 
                               && ( t.r.maxH     === null || t.r.maxH     >= height )
                               && ( t.r.maxLWH   === null || t.r.maxLWH   >= length + width + height )
                               && ( t.r.maxL2W2H === null || t.r.maxL2W2H >= length + (2 * width) + (2 * height) ); })
            .forEach(t => {
            for( p in t.t ) {
              if( p >= weight ) {
                result.push({ "n" : t.n, "h": t.h, "t": t.t[p] });
              }
            }
          });
          const domArray = document.querySelector("tbody");
          while(domArray.hasChildNodes()) { domArray.removeChild(domArray.firstChild); }
          tarifs
            .sort( (a,b) => { return a.t - b.t; })
            .forEach(t => {
              const tr = document.createElement("tr");
              tr.appendChild(document.createElement("td").appendChild(document.createTextNode(t.n)));
              tr.appendChild(document.createElement("td").appendChild(document.createTextNode(t.h?"à l maison":"en relais")));
              tr.appendChild(document.createElement("td").appendChild(document.createTextNode(t.t)));
              domArray.appendChild(tr);
            });
        };
      });
    </script>
  </head>
  <body>
    <h1>Format du Colis</h1>
    <form>
      <label for="length">Longueur (cm)</label> <input type="number" id="length" required />
      <label for="width">Largeur (cm)</label> <input type="number" id="width" required />
      <label for="height">Hauteur (cm)</label> <input type="number" id="height" required /> 
      <label for="weight">Poids (kg)</label> <input type="number" id="weight" required />
      <input type="submit" value="Calculer" />
    </form>
    <h1>Résultats</h1>
    <table>
      <thead>
        <tr>
          <th>Livreur</th>
          <th>Relais</th>
          <th>Tarif</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </body>
</html>
