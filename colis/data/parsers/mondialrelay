#!/bin/bash
for i in $( grep -n "Assurance Forfaitaire" $1 | cut -d: -f1 )
do
  echo "{\"n\":\"Mondial Relais R$( tail $1 -n +$i | head -n 1 | cut -d\> -f2 | cut -d\  -f2 | cut -d\< -f1 ) (lockers)\",\"u\":\"https://www.mondialrelay.fr/envoi-de-colis/tarifs-expeditions/\",\"relais\":\"https://www.mondialrelay.fr/trouver-le-point-relais-le-plus-proche-de-chez-moi/\",\"h\":false,\"r\":{\"maxL\":64,\"maxW\":41,\"maxH\":38},\"t\":[$( for j in $(head -n $( grep -n "<h2>" $1 | grep "international" | cut -d: -f1) $1 | grep \"Poids -n | cut -d: -f1);do echo -n ",{\"$( echo "scale=0; $( tail $1 -n +$j | head -n1 | cut -d\> -f2 | cut -d\< -f1 | cut -dK -f1 | tr , . ) * 1000 / 1" | bc )\":$( echo "$( tail $1 -n +$(( $j + 1 )) | head -n1 | cut -d\> -f2 | tr "€" "<"| cut -d\< -f1 | tr , . ) + $( tail $1 -n +$(( $i + 3 )) | head -n 1 | tr ",€" ".<" | cut -d\> -f2 | cut -d\< -f1  )" | bc ) }"; done |cut -c2- )],\"a\":{\"f\":$( tail $1 -n +$(( $i + 1 )) | head -n 1 | tr "€" "<" | cut -d\> -f2 | cut -d\< -f1 )}},"
  echo "{\"n\":\"Mondial Relais R$( tail $1 -n +$i | head -n 1 | cut -d\> -f2 | cut -d\  -f2 | cut -d\< -f1 )\",\"u\":\"https://www.mondialrelay.fr/envoi-de-colis/tarifs-expeditions/\",\"relais\":\"https://www.mondialrelay.fr/trouver-le-point-relais-le-plus-proche-de-chez-moi/\",\"h\":false,\"r\":{\"maxL\":120,\"maxLWH\":150},\"t\":[$( for j in $(head -n $( grep -n "<h2>" $1 | grep "international" | cut -d: -f1) $1 | grep \"Poids -n | cut -d: -f1);do echo -n ",{\"$( echo "scale=0; $( tail $1 -n +$j | head -n1 | cut -d\> -f2 | cut -d\< -f1 | cut -dK -f1 | tr , . ) * 1000 / 1" | bc )\":$( echo "$( tail $1 -n +$(( $j + 2 )) | head -n1 | cut -d\> -f2 | tr "€" "<"| cut -d\< -f1 | tr , . ) + $( tail $1 -n +$(( $i + 3 )) | head -n 1 | tr ",€" ".<" | cut -d\> -f2 | cut -d\< -f1  )" | bc ) }"; done |cut -c2- )],\"a\":{\"f\":$( tail $1 -n +$(( $i + 1 )) | head -n 1 | tr "€" "<" | cut -d\> -f2 | cut -d\< -f1 )}},"
  echo "{\"n\":\"Mondial Relais R$( tail $1 -n +$i | head -n 1 | cut -d\> -f2 | cut -d\  -f2 | cut -d\< -f1 )\",\"u\":\"https://www.mondialrelay.fr/envoi-de-colis/tarifs-expeditions/\",\"relais\":\"https://www.mondialrelay.fr/trouver-le-point-relais-le-plus-proche-de-chez-moi/\",\"h\":true,\"r\":{\"maxL\":120,\"maxLWH\":150},\"t\":[$( for j in $(head -n $( grep -n "<h2>" $1 | grep "international" | cut -d: -f1) $1 | grep \"Poids -n | cut -d: -f1);do echo -n ",{\"$( echo "scale=0; $( tail $1 -n +$j | head -n1 | cut -d\> -f2 | cut -d\< -f1 | cut -dK -f1 | tr , . ) * 1000 / 1" | bc )\":$( echo "$( tail $1 -n +$(( $j + 3 )) | head -n1 | cut -d\> -f2 | tr "€" "<"| cut -d\< -f1 | tr , . ) + $( tail $1 -n +$(( $i + 3 )) | head -n 1 | tr ",€" ".<" | cut -d\> -f2 | cut -d\< -f1  )" | bc ) }"; done |cut -c2- )],\"a\":{\"f\":$( tail $1 -n +$(( $i + 1 )) | head -n 1 | tr "€" "<" | cut -d\> -f2 | cut -d\< -f1 )}},"
done

echo "{\"n\":\"Mondial Relais (lockers)\",\"u\":\"https://www.mondialrelay.fr/envoi-de-colis/tarifs-expeditions/\",\"relais\":\"https://www.mondialrelay.fr/trouver-le-point-relais-le-plus-proche-de-chez-moi/\",\"h\":false,\"r\":{\"maxL\":64,\"maxW\":41,\"maxH\":38},\"t\":[$( for i in $(head -n `grep -n "<h2>" $1| grep "international" | cut -d: -f1` $1| grep \"Poids -n | cut -d: -f1);do echo -n ",{\"$( echo "scale=0; $( tail $1 -n +$i | head -n1 | cut -d\> -f2 | cut -d\< -f1 | cut -dK -f1 | tr , . ) * 1000 / 1" | bc )\":$( tail $1 -n +$(( $i + 1 )) | head -n1 | cut -d\> -f2 | tr "€" "<"| cut -d\< -f1 | tr , . )}"; done |cut -c2- )]},\"a\":{\"f\":25}},"
echo "{\"n\":\"Mondial Relais\",\"u\":\"https://www.mondialrelay.fr/envoi-de-colis/tarifs-expeditions/\",\"relais\":\"https://www.mondialrelay.fr/trouver-le-point-relais-le-plus-proche-de-chez-moi/\",\"h\":false,\"r\":{\"maxL\":120,\"maxLWH\":150},\"t\":[$( for i in $(head -n `grep -n "<h2>" $1 | grep "international" | cut -d: -f1` $1| grep \"Poids -n | cut -d: -f1);do echo -n ",{\"$( echo "scale=0; $( tail $1 -n +$i | head -n1 | cut -d\> -f2 | cut -d\< -f1 | cut -dK -f1 | tr , . ) * 1000 / 1" | bc )\":$( tail $1 -n +$(( $i + 2 )) | head -n1 | cut -d\> -f2 | tr "€" "<"| cut -d\< -f1 | tr , . )}"; done |cut -c2- )]},\"a\":{\"f\":25}},"
echo "{\"n\":\"Mondial Relais\",\"u\":\"https://www.mondialrelay.fr/envoi-de-colis/tarifs-expeditions/\",\"relais\":\"https://www.mondialrelay.fr/trouver-le-point-relais-le-plus-proche-de-chez-moi/\",\"h\":true,\"r\":{\"maxL\":120,\"maxLWH\":150},\"t\":[$( for i in $(head -n `grep -n "<h2>" $1 | grep "international" | cut -d: -f1` $1| grep \"Poids -n | cut -d: -f1);do echo -n ",{\"$( echo "scale=0; $( tail $1 -n +$i | head -n1 | cut -d\> -f2 | cut -d\< -f1 | cut -dK -f1 | tr , . ) * 1000 / 1" | bc )\":$( tail $1 -n +$(( $i + 3 )) | head -n1 | cut -d\> -f2 | tr "€" "<"| cut -d\< -f1 | tr , . )}"; done |cut -c2- )]},\"a\":{\"f\":25}}"
